"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const yargs_1 = __importDefault(require("yargs"));
const fs_1 = require("fs");
const path_1 = require("path");
const log_1 = require("./log");
const package_json_1 = require("../package.json");
const utils_1 = require("./utils");
async function main() {
    const { argv } = yargs_1.default
        .option('input', { alias: 'i', default: 'shas.txt', type: 'string' })
        .version(package_json_1.version)
        .alias('v', 'version')
        .help()
        .alias('h', 'help');
    const shaFileContent = (0, fs_1.readFileSync)(argv.input).toString();
    const shaMap = {};
    for (const line of shaFileContent.split('\n')) {
        // Expect line to be of the form
        // <sha> node-v<version>-host-arch
        const lineParts = line.split(/\s+/);
        if (lineParts.length === 2) {
            // eslint-disable-next-line prefer-destructuring
            shaMap[lineParts[1]] = lineParts[0];
        }
    }
    // Sort map
    const sortedShaMap = {};
    for (const nodeVersion of Object.keys(shaMap).sort(utils_1.nodeBinarySortFunction)) {
        sortedShaMap[nodeVersion] = shaMap[nodeVersion];
    }
    (0, fs_1.writeFileSync)((0, path_1.join)(__dirname, '../lib/expected-shas.json'), `${JSON.stringify(sortedShaMap, null, 2)}\n`);
}
main().catch((error) => {
    if (!error.wasReported)
        log_1.log.error(error);
    process.exit(2);
});
//# sourceMappingURL=generate-expected-shas.js.map