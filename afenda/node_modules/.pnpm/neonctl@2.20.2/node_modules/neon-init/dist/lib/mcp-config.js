import { getVSCodeGlobalConfigDir } from "./editors.js";
import { existsSync, mkdirSync, readFileSync, writeFileSync } from "node:fs";
import { dirname, resolve } from "node:path";

//#region src/lib/mcp-config.ts
/**
* Gets or creates the MCP configuration for a specific editor
* - Cursor: Global config at ~/.cursor/mcp.json
* - VS Code: Try global config first, then workspace
* - Claude CLI: Global config at ~/.claude.json
*/
function getMCPConfig(homeDir, workspaceDir, editor) {
	let mcpConfigPath;
	if (editor === "VS Code") {
		const vscodeGlobalDir = getVSCodeGlobalConfigDir(homeDir);
		if (vscodeGlobalDir && existsSync(vscodeGlobalDir)) mcpConfigPath = resolve(vscodeGlobalDir, "mcp.json");
		else mcpConfigPath = resolve(workspaceDir, ".vscode", "mcp.json");
	} else if (editor === "Claude CLI") mcpConfigPath = resolve(homeDir, ".claude.json");
	else mcpConfigPath = resolve(homeDir, ".cursor", "mcp.json");
	if (existsSync(mcpConfigPath)) try {
		const content = readFileSync(mcpConfigPath, "utf-8");
		return {
			config: JSON.parse(content),
			configPath: mcpConfigPath
		};
	} catch (_error) {
		return {
			config: editor === "VS Code" ? { servers: {} } : { mcpServers: {} },
			configPath: mcpConfigPath
		};
	}
	return {
		config: editor === "VS Code" ? { servers: {} } : { mcpServers: {} },
		configPath: mcpConfigPath
	};
}
/**
* Writes the MCP configuration to the appropriate location
* - Cursor: Global config at ~/.cursor/mcp.json
* - VS Code: Global config (preferred) or workspace config (fallback)
* - Claude CLI: Global config at ~/.claude.json
*/
function writeMCPConfig(configPath, config) {
	const editorDir = dirname(configPath);
	if (!existsSync(editorDir)) mkdirSync(editorDir, { recursive: true });
	writeFileSync(configPath, JSON.stringify(config, null, 2), "utf-8");
}

//#endregion
export { getMCPConfig, writeMCPConfig };
//# sourceMappingURL=mcp-config.js.map